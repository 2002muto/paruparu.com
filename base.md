# パルムちゃんブログサイト 設計仕様（base.md）

## 1. サイト概要

- パルムちゃんの写真とひとこと記事を毎日投稿するブログサイト
- 投稿者は管理者（あなた）1名
- コメントは誰でも投稿可能（匿名OK）
- コメント削除は管理者のみ可能（サーバ側で権限チェック）
- 記事本文は **MDX** で管理
- コメントは **Supabase** に保存（Markdown Lite対応）
- ヘッダーに以下リンクを配置：Instagram / TikTok / 買い物（将来実装） / お問い合わせ

---

## 2. ページ一覧 & ルーティング

| パス           | 内容                                           |
| -------------- | ---------------------------------------------- |
| `/`            | トップページ（記事一覧・カード表示・モーダル） |
| `/post/[slug]` | 個別記事ページ（SEO/シェア対応）               |
| `/contact`     | お問い合わせフォーム                           |
| `/admin`       | 管理コンパネ（コメント削除・将来投稿管理）     |

---

## 3. レイアウト（概要）

### 共通ヘッダー

```
┌──────────────────────────────────────────────────────┐
│ [パルムちゃんブログ]           INSTAGRAM  TIKTOK  買い物  お問い合わせ │
└──────────────────────────────────────────────────────┘
```

### トップページ `/`

```
[ファーストビュー]
  タイトル「パルムちゃんと暮らす毎日」
  リード文「写真とひとことを毎日更新」

[記事カードグリッド]
  ┌───────────┐  ┌───────────┐
  │ 画像 16:9       │  │ 画像 16:9       │
  └───────────┘  └───────────┘
   日付 ひとこと       日付 ひとこと
   タイトル            タイトル

[カードクリック → モーダルOPEN + URLを /post/[slug] に変更]
```

### 記事モーダル（トップから）

```
[×] 日付
タイトル
画像（任意）
本文（MDXレンダリング）

[コメント欄]
  名前（任意）
  コメント本文（Markdown Lite）
  投稿ボタン

[コメント一覧]
  名前・日付・本文
  （管理者のみ削除ボタン表示）
```

### 個別記事ページ `/post/[slug]`

```
パンくず Home > タイトル
タイトル / 日付
画像
本文（MDXレンダリング）

[コメント欄・一覧はモーダルと同仕様]
```

### お問い合わせ `/contact`

```
お名前
メールアドレス
本文
Turnstile/recaptcha
送信ボタン
```

### 管理コンパネ `/admin`

```
[コメント管理]
  一覧（検索・絞り込み・削除）

[投稿管理（将来実装）]
  新規作成/編集（MDX）
```

---

## 4. 記事モーダルと個別記事ページの違い

| 項目 | モーダル                         | 個別ページ                    |
| ---- | -------------------------------- | ----------------------------- |
| 表示 | トップ上のオーバーレイ           | 独立したページ                |
| URL  | /post/\[slug]（pushStateで変更） | /post/\[slug]（直接アクセス） |
| SEO  | JS依存で弱い                     | SSR/SSGで強い                 |
| 用途 | 連続閲覧・UX重視                 | 共有・ブックマーク・検索流入  |

---

## 5. モーダル+SEO両立フロー（pushState）

```
[Top /]
  ↓カードクリック
  モーダルOPEN
  pushState('/post/[slug]')

[戻る]
  popstateでモーダルCLOSE
  URLを'/'に戻す

[リロード or 直接アクセス]
  SSR/SSGで個別記事ページとして表示
```

---

## 6. コメント仕様

- 匿名投稿可（名前/メール任意）
- 本文はMarkdown Lite対応（太字/斜体/リンク/箇条書き）
- 画像投稿は当初禁止（将来拡張可能）
- スパム対策：Cloudflare Turnstile + レート制限
- 削除はサーバAPIで管理者チェック

**コメント保存先**

```sql
comments (
  id uuid primary key,
  post_slug text,
  display_name text,
  body text,
  created_at timestamptz default now()
)
```

---

## 7. 管理者機能

- `/admin`でコメント一覧・削除
- `/admin`は認証必須（Supabase Auth）
- 記事投稿はMDXファイルとして管理（Git）または将来CMS化

---

## 8. フロントエンド要素（主要コンポーネント）

- `<Header />`（共通ヘッダー）
- `<PostCard />`（記事カード）
- `<PostModal />`（記事モーダル）
- `<CommentBox />`（コメント投稿フォーム）
- `<CommentList />`（コメント一覧）
- `<AdminComments />`（管理用コメント一覧）

---

## 9. 実装時注意点

- モーダルは`pushState`でURL変更し、`popstate`で閉じる
- 個別記事ページはSSR/SSGでOGPタグを付与
- Markdownレンダリング時はXSS対策（DOMPurify等）
- コメントAPIはCSRF対策＆Bot対策必須
- Supabase RLSはコメント削除時のみ制御、投稿は誰でも可

---

## 10. 運用メモ

- 記事はMDXでリポジトリ管理（GitHub）
- コメントはSupabase（Storage未使用）
- 管理者はSupabase Authでログインし/adminアクセス
- 買い物リンクは将来実装予定（現状はアラート表示）
